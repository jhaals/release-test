name: "Dependabot changeset maker"
on:
- pull_request_target

jobs:
  generate-changeset:
    runs-on: ubuntu-latest
    if: github.actor == 'dependabot[bot]' && github.repository == 'jhaals/release-test'
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 2
        ref: ${{ github.head_ref }} 
    - name: Configure Git
      run: |
        git config --global user.email noreply@backstage.io
        git config --global user.name 'Github changeset workflow'
    - name: Generate changeset
      uses: actions/github-script@v5
      with:
        script: |
          // const exec = require('@actions/exec');
          const branch = await exec.exec('git branch --show-current');
          if (!branch.startsWith('dependabot/')) {
            console.log('Not a dependabot branch');
            return;
          }
          console.log('win')